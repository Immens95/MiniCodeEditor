<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini VSCode Browser</title>

<!-- CodeMirror 5 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/htmlmixed/htmlmixed.min.js"></script>

<!-- Addons -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/closetag.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/html-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/javascript-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/css-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/anyword-hint.min.js"></script>

<style>
html, body { margin:0; height:100%; overflow:hidden; }
body { font-family: "Fira Code", monospace; background:#14191f; color:#e4f1f9; display:flex; flex-direction:column; }
.container { flex:1; display:flex; flex-direction:column; margin: auto; width: 100%; }
.preview { flex:1; border-bottom:2px solid #00c7b1; overflow:auto; background:#1f9aff10; }
iframe { width:100%; height:100%; border:none; background:white; }
.editor { overflow:hidden; flex:1; }
.CodeMirror { height:100% !important; width:100% !important; }
#settingsBtn { position:fixed; bottom:15px; right:15px; background:#00c7b1; border:none; border-radius:50%; width:40px; height:40px; font-size:18px; cursor:pointer; opacity:0; display:flex; align-items:center; justify-content:center; z-index:1000; transition:0.3s;}
#settingsBtn:hover {opacity:1;}
#settingsModal { position:fixed; bottom:60px; right:15px; background:#222; color:white; padding:15px; border-radius:8px; display:none; flex-direction:column; gap:10px; min-width:260px; box-shadow:0 4px 20px rgba(0,0,0,0.5); font-size:14px; z-index:1001; }
#settingsModal label { display:flex; justify-content:space-between; align-items:center; }
#settingsModal input, #settingsModal select { margin-left:10px; flex:1; }
</style>
</head>
<body>
<div class="container" id="container">
  <div class="preview" id="previewContainer"><iframe id="previewFrame"></iframe></div>
  <div class="editor" id="editorContainer"></div>
</div>

<button id="settingsBtn">⚙️</button>
<div id="settingsModal">
  <label>Font Size: <input type="number" id="fontSize" value="16" min="10" max="30">px</label>
  <label>Font Family: 
    <select id="fontFamily">
      <option value="Fira Code">Fira Code</option>
      <option value="JetBrains Mono">JetBrains Mono</option>
      <option value="Courier New">Courier New</option>
      <option value="monospace">Monospace</option>
    </select>
  </label>
  <label>Editor position: <input type="range" id="splitRangeH" min="-100" max="100" value="100"></label>
  <label>Editor %: <input type="range" id="splitRangeV" min="-100" max="100" value="50"></label>
  <label>Preset: 
    <select id="preset">
      <option value=""> -select- </option>
      <option value="classicMobile">mobile</option>
      <option value="mobileDesktop">16:9 vertical</option>
      <option value="mobileDesktopPlus">18:9 vertical</option>
      <option value="mobileWideDesktop">21:9 vertical</option>
      <option value="Hmobile">16:10 vertical</option>
      <option value="classicDesktop">desktop</option>
      <option value="desktop">16:9 horizzontal</option>
      <option value="wideDesktop">21:9 horizzontal</option>
    </select>
  </label>
  <label>Body width: <input type="number" id="bodyW" value="1920">px</label>
  <label>Body height: <input type="number" id="bodyH" value="1080">px</label>
  <button id="fitScreen">Fit to Screen</button>
</div>

<script>
const initialCode = `<!DOCTYPE html>
<html>
  <head>
    <style>
      .btn { 
        padding: 15px 30px; 
        font-size: 20px; 
        border: none; 
        border-radius: 8px; 
        cursor: pointer; 
        background: #1f9aff; 
        color: white; 
        transition: 0.3s;
      }
      .btn:hover { 
        background: #00c7b1; 
        transform: scale(1.1);
      }
    </style>
  </head>
  <body>
    <div>
    </div>
    <button class="btn">Hover Me</button>
  </body>
</html>`;

// Editor
const editor = CodeMirror(document.getElementById("editorContainer"), {
  value: initialCode,
  mode: "htmlmixed",
  theme: "dracula",
  lineNumbers: true,
  autoCloseBrackets: true,
  autoCloseTags: true,
  extraKeys: {"Ctrl-Space": "autocomplete", "Tab": function(cm){
    // Snippet per "class" o "id"
    const cursor = cm.getCursor();
    const token = cm.getTokenAt(cursor);
    const start = token.start;
    const end = cursor.ch;
    const word = token.string.slice(0, end-start);

    if(["cla","c","cl","class","clas"].find((element) => element === word)){cm.replaceRange('class=""', {line:cursor.line,ch:start},{line:cursor.line,ch:end}); cm.setCursor({line:cursor.line,ch:start+7});}
    else if(["i","id"].find((element) => element === word)){cm.replaceRange('id=""', {line:cursor.line,ch:start},{line:cursor.line,ch:end}); cm.setCursor({line:cursor.line,ch:start+4});}
    else cm.execCommand("insertTab");
  }}
});

// Preview live
const previewFrame = document.getElementById("previewFrame");
function updatePreview() { previewFrame.srcdoc = editor.getValue(); }
editor.on("change", updatePreview);
window.addEventListener("load", updatePreview);

// Bottone impostazioni
const settingsBtn = document.getElementById("settingsBtn");
const settingsModal = document.getElementById("settingsModal");
settingsBtn.addEventListener("click", ()=>{settingsModal.style.display=settingsModal.style.display==="flex"?"none":"flex";});

// Impostazioni
const preset=document.getElementById("preset");

const fontSizeInput=document.getElementById("fontSize");
const fontFamilySelect=document.getElementById("fontFamily");
const splitRangeV=document.getElementById("splitRangeV");
const splitRangeH=document.getElementById("splitRangeH");

var bodyW=document.getElementById("bodyW");
var bodyH=document.getElementById("bodyH");
const previewContainer=document.getElementById("previewContainer");
const editorContainer=document.getElementById("editorContainer");
const container=document.getElementById("container");

const fitScreen=document.getElementById("fitScreen");

function updateSizes(){
  previewContainer.style.flex=splitRangeV.value;
  editorContainer.style.flex=100-splitRangeV.value;

  if( splitRangeH.value < 0 && splitRangeH.value != -100){document.querySelector(".container").style.flexDirection="row-reverse";
    previewContainer.style.width="50%"; editorContainer.style.width="50%";
  }
  if( splitRangeH.value > 0 && splitRangeH.value != 100){document.querySelector(".container").style.flexDirection="row";
    previewContainer.style.width="50%"; editorContainer.style.width="50%";
  }

  if( splitRangeH.value <= -100 ){document.querySelector(".container").style.flexDirection="column-reverse";
    previewContainer.style.width="100%"; editorContainer.style.width="100%";
  }
  if( splitRangeH.value >= 100) {document.querySelector(".container").style.flexDirection="column";
    previewContainer.style.width="100%"; editorContainer.style.width="100%";
  }
  editor.setSize("100%", editorContainer.offsetHeight+"px");
}
function updateBody(){
  container.style.width=bodyW.value+'px';
  container.style.height=bodyH.value+'px';
}

preset.addEventListener("change", (e) => {
  console.log(e.target.value);
  container.style.height = window.innerHeight+'px';;
  if(e.target.value === 'classicMobile'){
    container.style.width = (window.innerHeight / 18 ) * 9 +'px';
  } else if(e.target.value === 'mobileDesktop'){
    container.style.width = (window.innerHeight / 16 ) * 9 +'px';
  } else if(e.target.value === 'mobileDesktopPlus'){
    container.style.width = (window.innerHeight / 18 ) * 9 +'px';
  } else if(e.target.value === 'mobileWideDesktop'){
    container.style.width = (window.innerHeight / 21 ) * 9 +'px';
  } else if(e.target.value === 'Hmobile'){
    container.style.width = (window.innerHeight / 19 ) * 9 +'px';

  } else if(e.target.value === 'classicDesktop'){
    container.style.width = (window.innerHeight / 3 ) * 4 +'px';
  } else if(e.target.value === 'desktop'){
    container.style.width = (window.innerHeight / 9 ) * 16 +'px';
  } else if(e.target.value === 'wideDesktop'){
    container.style.width = (window.innerHeight / 9 ) * 21 +'px';
  }else{

  }
  bodyW.value=parseInt(container.style.width);
  bodyH.value=parseInt(container.style.height);
});

splitRangeV.addEventListener("input", updateSizes);
splitRangeH.addEventListener("input", updateSizes);

bodyW.addEventListener("input", updateBody);
bodyH.addEventListener("input", updateBody);

fitScreen.addEventListener("click", () => {
  bodyW.value=window.innerWidth;
  bodyH.value=window.innerHeight;
  updateBody();
});

window.addEventListener("resize", updateSizes);
updateSizes();

// Font
fontSizeInput.addEventListener("input", e=>editor.getWrapperElement().style.fontSize=e.target.value+"px");
fontFamilySelect.addEventListener("change", e=>editor.getWrapperElement().style.fontFamily=e.target.value);

// Auto-complete su input
editor.on("inputRead", function(cm, change){
  if(change.text[0].match(/[\w\.]/)){ cm.showHint({hint: CodeMirror.hint.anyword}); }
});
</script>
</body>
</html>

